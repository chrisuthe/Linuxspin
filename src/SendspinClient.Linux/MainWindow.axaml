<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:SendspinClient.Linux.ViewModels"
        mc:Ignorable="d"
        d:DesignWidth="400"
        d:DesignHeight="300"
        x:Class="SendspinClient.Linux.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="Sendspin"
        Width="400"
        Height="300"
        MinWidth="350"
        MinHeight="250"
        WindowStartupLocation="CenterScreen"
        CanResize="True">

    <Design.DataContext>
        <vm:MainViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto,Auto">
        <!-- Server Connection Status Bar -->
        <Border Grid.Row="0"
                Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                Padding="12,8">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- Connection Indicator -->
                <StackPanel Grid.Column="0"
                            Orientation="Horizontal"
                            Spacing="8"
                            VerticalAlignment="Center">
                    <!-- Green dot when connected -->
                    <Ellipse Width="10"
                             Height="10"
                             VerticalAlignment="Center"
                             Fill="#4CAF50"
                             IsVisible="{Binding IsConnected}" />
                    <!-- Red dot when disconnected -->
                    <Ellipse Width="10"
                             Height="10"
                             VerticalAlignment="Center"
                             Fill="#F44336"
                             IsVisible="{Binding !IsConnected}" />
                    <TextBlock Text="{Binding ConnectionStatusText}"
                               VerticalAlignment="Center"
                               FontSize="12" />
                </StackPanel>

                <!-- Server Name -->
                <TextBlock Grid.Column="1"
                           Text="{Binding ServerName}"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           FontWeight="SemiBold"
                           IsVisible="{Binding IsConnected}" />

                <!-- Server Selection (when disconnected) -->
                <ComboBox Grid.Column="1"
                          ItemsSource="{Binding DiscoveredServers}"
                          SelectedItem="{Binding SelectedServer}"
                          IsVisible="{Binding !IsConnected}"
                          HorizontalAlignment="Stretch"
                          Margin="12,0"
                          PlaceholderText="Select a server...">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}" />
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <!-- Connect/Disconnect Button -->
                <Button Grid.Column="2"
                        Command="{Binding ConnectCommand}"
                        IsVisible="{Binding !IsConnected}"
                        Content="Connect"
                        Padding="12,4" />
                <Button Grid.Column="2"
                        Command="{Binding DisconnectCommand}"
                        IsVisible="{Binding IsConnected}"
                        Content="Disconnect"
                        Padding="12,4" />
            </Grid>
        </Border>

        <!-- Track Information Area -->
        <Border Grid.Row="1"
                Padding="16">
            <StackPanel VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        Spacing="8">
                <!-- Track Title -->
                <TextBlock Text="{Binding TrackTitle, FallbackValue='No Track Playing'}"
                           FontSize="20"
                           FontWeight="Bold"
                           HorizontalAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           MaxWidth="350" />

                <!-- Artist -->
                <TextBlock Text="{Binding Artist, FallbackValue=''}"
                           FontSize="14"
                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                           HorizontalAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           MaxWidth="350"
                           IsVisible="{Binding Artist, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                <!-- Playback Status -->
                <TextBlock Text="{Binding PlaybackStatusText}"
                           FontSize="12"
                           Foreground="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                           HorizontalAlignment="Center"
                           IsVisible="{Binding IsConnected}" />
            </StackPanel>
        </Border>

        <!-- Playback Controls -->
        <Border Grid.Row="2"
                Padding="16,8"
                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Center"
                        Spacing="16">
                <!-- Play/Pause Button -->
                <Button Command="{Binding PlayPauseCommand}"
                        IsEnabled="{Binding IsConnected}"
                        Width="48"
                        Height="48"
                        HorizontalContentAlignment="Center"
                        VerticalContentAlignment="Center">
                    <TextBlock Text="{Binding PlayPauseButtonText}"
                               FontSize="16"
                               FontWeight="Bold" />
                </Button>
            </StackPanel>
        </Border>

        <!-- Volume and Device Selection -->
        <Border Grid.Row="3"
                Padding="16,12"
                Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- Volume Icon -->
                <TextBlock Grid.Column="0"
                           Text="Vol"
                           VerticalAlignment="Center"
                           FontSize="12"
                           Margin="0,0,8,0" />

                <!-- Volume Slider -->
                <Slider Grid.Column="1"
                        Minimum="0"
                        Maximum="100"
                        Value="{Binding Volume}"
                        VerticalAlignment="Center"
                        IsEnabled="{Binding IsConnected}" />

                <!-- Volume Percentage -->
                <TextBlock Grid.Column="2"
                           Text="{Binding Volume, StringFormat={}{0:F0}%}"
                           VerticalAlignment="Center"
                           FontSize="12"
                           Margin="8,0,0,0"
                           MinWidth="35"
                           TextAlignment="Right" />
            </Grid>
        </Border>
    </Grid>

</Window>
